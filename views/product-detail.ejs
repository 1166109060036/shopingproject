<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><%= product.name %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .quantity-selector button {
      width: 40px;
      height: 40px;
      font-size: 20px;
    }
    .quantity-selector input {
      text-align: center;
      width: 60px;
      font-size: 18px;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container mt-5 pt-5">
    <a href="/products" class="btn btn-danger mb-4" >← กลับหน้าสินค้า</a>

    <div class="card shadow-lg">
      <div class="row g-0">
        <div class="col-md-6">
          <% if (product.image) { %>
            <img src="<%= product.image %>" class="img-fluid rounded-start w-100 h-100" style="object-fit: cover;">
          <% } else { %>
            <div class="bg-secondary text-white text-center p-5">ไม่มีรูปภาพ</div>
          <% } %>
        </div>

        <div class="col-md-6">
          <div class="card-body">
            <h2 class="card-title mb-3"><%= product.product_name %></h2>
            <p class="card-text"><%= product.description %></p>
            <h4 class="text-primary fw-bold mb-2">ราคา: <%= product.price %> บาท</h4>
            <p class="<%= product.quantity > 0 ? 'text-success' : 'text-danger' %> mb-3">
              <%= product.quantity > 0 ? 'จำนวนในคลัง: ' + product.quantity : 'หมดสต็อก' %>
            </p>

            <% if (product.quantity > 0) { %>
              <form action="/add-to-cart/<%= product.product_id %>" method="POST" class="mt-3" onsubmit="injectUserId()">
                <input type="hidden" name="userId" id="userIdInput">
                <div class="quantity-selector mb-3">
                  <button type="button" class="btn btn-outline-primary" onclick="changeQuantity(-1)">−</button>
                  <input type="number" name="quantity" id="quantity" min="1" max="<%= product.quantity %>" value="1">
                  <button type="button" class="btn btn-outline-primary" onclick="changeQuantity(1)">+</button>
                </div>
                <button type="submit" class="btn btn-success">หยิบใส่ตะกร้า</button>
              </form>
            <% } else { %>
              <button class="btn btn-secondary" disabled>หมดสต็อก</button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function changeQuantity(delta) {
      const input = document.getElementById('quantity');
      let current = parseInt(input.value);
      const min = parseInt(input.min);
      const max = parseInt(input.max);

      let updated = current + delta;
      if (updated < min) updated = min;
      if (updated > max) updated = max;

      input.value = updated;
    }

    function injectUserId() {
      const userId = localStorage.getItem('userId');
      document.getElementById('userIdInput').value = userId;
    }

  </script>
</body>
</html>
